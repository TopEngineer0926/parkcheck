{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactNativeI18nLocalize = require(\"react-native-i18n-localize\");\n\nvar _native = require(\"@react-navigation/native\");\n\nvar _reactNative = require(\"react-native\");\n\nvar _reactNativeCamera = require(\"react-native-camera\");\n\nvar _reactNativeImageResizer = _interopRequireDefault(require(\"react-native-image-resizer\"));\n\nvar _reactNativeFs = _interopRequireDefault(require(\"react-native-fs\"));\n\nvar _reactNativeImageMarker = _interopRequireDefault(require(\"react-native-image-marker\"));\n\nvar _dirStorage = require(\"../storage/dirStorage\");\n\nvar _this = this,\n    _jsxFileName = \"D:\\\\Works\\\\Workspace\\\\Mobile\\\\parkcheck-android-app-master\\\\parkcheck-android-app-master\\\\src\\\\screens\\\\Alpr.js\";\n\nvar moment = require('moment');\n\nvar alertFlag = true;\n\nvar Alpr = function Alpr(_ref) {\n  var navigation = _ref.navigation,\n      route = _ref.route;\n\n  var _useState = (0, _react.useState)([]),\n      _useState2 = (0, _slicedToArray2.default)(_useState, 2),\n      detectedText = _useState2[0],\n      setDetectedText = _useState2[1];\n\n  var _useState3 = (0, _react.useState)(''),\n      _useState4 = (0, _slicedToArray2.default)(_useState3, 2),\n      hintNumber = _useState4[0],\n      setHintNumber = _useState4[1];\n\n  var cameraRef = (0, _react.useRef)(null);\n  var routesName = (0, _native.useNavigationState)(function (state) {\n    return state.routes[state.index].name;\n  });\n  var licList = ['ZH', 'BE', 'LU', 'UR', 'SZ', 'OW', 'NW', 'GL', 'ZG', 'FR', 'SO', 'BS', 'BL', 'SH', 'AR', 'AI', 'SG', 'GR', 'AG', 'TG', 'TI', 'VD', 'VS', 'NE', 'GE', 'JU'];\n  var count = 0;\n\n  var failedToSaveImage = function failedToSaveImage() {\n    _reactNative.Alert.alert(_reactNativeI18nLocalize.i18n.t('warn'), _reactNativeI18nLocalize.i18n.t('failed_save_picture'), [{\n      text: _reactNativeI18nLocalize.i18n.t('ignore'),\n      onPress: function onPress() {\n        navigation.navigate('CreateViolation', {\n          scanned_licplate: hintNumber,\n          alprImage: 'empty'\n        });\n        alertFlag = true;\n      }\n    }, {\n      text: _reactNativeI18nLocalize.i18n.t('try_again'),\n      onPress: function onPress() {\n        alertFlag = true;\n      }\n    }]);\n  };\n\n  var setLicPlate = function setLicPlate() {\n    var options, data, newImageName, newFilepath;\n    return _regenerator.default.async(function setLicPlate$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            alertFlag = false;\n\n            if (!cameraRef) {\n              _context.next = 13;\n              break;\n            }\n\n            if (!(hintNumber == '')) {\n              _context.next = 6;\n              break;\n            }\n\n            _reactNative.Alert.alert(_reactNativeI18nLocalize.i18n.t('warn'), _reactNativeI18nLocalize.i18n.t('no_licplate'), [{\n              text: _reactNativeI18nLocalize.i18n.t('ok')\n            }]);\n\n            _context.next = 13;\n            break;\n\n          case 6:\n            options = {\n              quality: 0.5,\n              base64: true\n            };\n            _context.next = 9;\n            return _regenerator.default.awrap(cameraRef.current.takePictureAsync(options));\n\n          case 9:\n            data = _context.sent;\n            newImageName = moment().format('DDMMYY_HHmmSSS') + \".jpg\";\n            newFilepath = 'file://' + (_dirStorage.dirPictures + \"/\" + newImageName);\n\n            _reactNativeImageResizer.default.createResizedImage('data:image/jpeg;base64,' + data.base64, 1000, 1300, 'JPEG', 60, 90).then(function (response) {\n              var markText = \"\" + moment().format('DD.MM.YYYY HH:mm:ss') + ' ' + route.params.gpsText;\n\n              _reactNativeImageMarker.default.markText({\n                src: _reactNative.Platform.OS === 'android' ? 'file://' + response.path : response.path,\n                text: markText,\n                X: 10,\n                Y: 10,\n                color: '#fff',\n                fontName: 'Arial-BoldItalicMT',\n                fontSize: 15,\n                scale: 1,\n                quality: 100,\n                textBackgroundStyle: {\n                  type: 'default',\n                  paddingX: 10,\n                  paddingY: 10,\n                  color: '#999'\n                }\n              }).then(function (res) {\n                _reactNativeFs.default.moveFile(_reactNative.Platform.OS === 'android' ? 'file://' + res : res, newFilepath);\n\n                _reactNativeFs.default.scanFile(newFilepath);\n\n                navigation.navigate('CreateViolation', {\n                  scanned_licplate: hintNumber,\n                  alprImage: newFilepath\n                });\n                alertFlag = true;\n                console.log(newFilepath);\n              }).catch(function (err) {\n                failedToSaveImage();\n                console.log('error 1 ===  ', err);\n              });\n            }).catch(function (err) {\n              failedToSaveImage();\n              console.log('error 2 ===  ', err);\n            });\n\n          case 13:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var recognizeNumber = function recognizeNumber(block) {\n    count++;\n\n    if (count == 4 && alertFlag) {\n      setDetectedText(block);\n      showHint();\n      count = 0;\n    }\n  };\n\n  var showHint = function showHint() {\n    if (detectedText != null) {\n      for (var i = 0; i < detectedText.length; i++) {\n        var regex = /[A-Z]{2}[ ]{0,1}[-]{0,1}[0-9]{1,7}/g;\n        var found = detectedText[i].value.match(regex);\n\n        if (found != null) {\n          var _ret = function () {\n            var tempLic = found[0].split(\" \").join(\"\");\n            var Lic = tempLic.split(\"-\").join(\"\");\n            var exist = false;\n            licList.map(function (item) {\n              if (Lic.indexOf(item) >= 0) exist = true;\n            });\n            if (exist) setHintNumber(Lic);\n            return \"break\";\n          }();\n\n          if (_ret === \"break\") break;\n        }\n      }\n    }\n  };\n\n  (0, _react.useEffect)(function () {\n    return navigation.addListener('focus', function () {\n      alertFlag = true;\n\n      _reactNative.PermissionsAndroid.request(_reactNative.PermissionsAndroid.PERMISSIONS.WRITE_EXTERNAL_STORAGE);\n    });\n  }, []);\n\n  var cameraContent = _react.default.createElement(_reactNativeCamera.RNCamera, {\n    ref: cameraRef,\n    style: styles.preview,\n    captureAudio: false,\n    onTextRecognized: function onTextRecognized(text) {\n      return recognizeNumber(text.textBlocks);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 5\n    }\n  }, _react.default.createElement(_reactNative.View, {\n    style: styles.maskOutter,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 7\n    }\n  }, _react.default.createElement(_reactNative.View, {\n    style: [{\n      flex: maskRowHeight\n    }, styles.maskRow, styles.maskFrame],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 9\n    }\n  }), _react.default.createElement(_reactNative.View, {\n    style: [{\n      flex: 30\n    }, styles.maskCenter],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 9\n    }\n  }, _react.default.createElement(_reactNative.View, {\n    style: [{\n      width: maskColWidth\n    }, styles.maskFrame],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 11\n    }\n  }), _react.default.createElement(_reactNative.View, {\n    style: styles.maskInner,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 11\n    }\n  }), _react.default.createElement(_reactNative.View, {\n    style: [{\n      width: maskColWidth\n    }, styles.maskFrame],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 11\n    }\n  })), _react.default.createElement(_reactNative.View, {\n    style: [{\n      flex: maskRowHeight\n    }, styles.maskRow, styles.maskFrame],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 9\n    }\n  })), _react.default.createElement(_reactNative.View, {\n    style: {\n      flex: 0,\n      flexDirection: 'row',\n      justifyContent: 'center',\n      backgroundColor: 'transparent'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 7\n    }\n  }, _react.default.createElement(_reactNative.TouchableOpacity, {\n    style: styles.capture,\n    onPress: setLicPlate,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 9\n    }\n  }, _react.default.createElement(_reactNative.Text, {\n    style: {\n      fontSize: 14\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 11\n    }\n  }, \" \", _reactNativeI18nLocalize.i18n.t('confirm'), \" \"))));\n\n  return _react.default.createElement(_reactNative.View, {\n    style: styles.container,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 5\n    }\n  }, routesName == \"Alpr\" && cameraContent, _react.default.createElement(_reactNative.View, {\n    style: styles.hintContain,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 7\n    }\n  }, _react.default.createElement(_reactNative.Text, {\n    style: styles.hint,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 9\n    }\n  }, _reactNativeI18nLocalize.i18n.t('scanned_data'), \":  \", hintNumber)));\n};\n\nvar _default = Alpr;\nexports.default = _default;\n\nvar _Dimensions$get = _reactNative.Dimensions.get('window'),\n    height = _Dimensions$get.height,\n    width = _Dimensions$get.width;\n\nvar maskRowHeight = Math.round((height - 300) / 20);\nvar maskColWidth = (width - 300) / 2;\n\nvar styles = _reactNative.StyleSheet.create({\n  container: {\n    flex: 1,\n    flexDirection: 'column',\n    backgroundColor: 'black',\n    position: 'relative'\n  },\n  preview: {\n    flex: 1,\n    justifyContent: 'flex-end',\n    alignItems: 'center'\n  },\n  capture: {\n    flex: 0,\n    backgroundColor: '#fff',\n    borderRadius: 5,\n    padding: 15,\n    paddingHorizontal: 20,\n    alignSelf: 'center',\n    marginBottom: 30\n  },\n  hint: {\n    fontSize: 20,\n    color: '#fff',\n    width: '100%',\n    padding: 5,\n    paddingLeft: 10,\n    paddingRight: 10,\n    textAlign: 'center'\n  },\n  hintContain: {\n    position: 'absolute',\n    left: 0,\n    top: 0,\n    width: '100%',\n    backgroundColor: \"#126FEA\",\n    textAlign: \"center\",\n    display: \"flex\",\n    height: 70,\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: \"center\"\n  },\n  maskOutter: {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    width: '100%',\n    height: '100%',\n    alignItems: 'center',\n    justifyContent: 'space-around'\n  },\n  maskInner: {\n    width: width - 40,\n    backgroundColor: 'transparent',\n    borderColor: 'white',\n    borderWidth: 1\n  },\n  maskFrame: {\n    backgroundColor: 'rgba(1,1,1,0.6)'\n  },\n  maskRow: {\n    width: '100%'\n  },\n  maskCenter: {\n    flexDirection: 'row'\n  }\n});","map":{"version":3,"sources":["D:/Works/Workspace/Mobile/parkcheck-android-app-master/parkcheck-android-app-master/src/screens/Alpr.js"],"names":["moment","require","alertFlag","Alpr","navigation","route","detectedText","setDetectedText","hintNumber","setHintNumber","cameraRef","routesName","state","routes","index","name","licList","count","failedToSaveImage","Alert","alert","i18n","t","text","onPress","navigate","scanned_licplate","alprImage","setLicPlate","options","quality","base64","current","takePictureAsync","data","newImageName","format","newFilepath","dirPictures","ImageResizer","createResizedImage","then","response","markText","params","gpsText","Marker","src","Platform","OS","path","X","Y","color","fontName","fontSize","scale","textBackgroundStyle","type","paddingX","paddingY","res","RNFS","moveFile","scanFile","console","log","catch","err","recognizeNumber","block","showHint","i","length","regex","found","value","match","tempLic","split","join","Lic","exist","map","item","indexOf","addListener","PermissionsAndroid","request","PERMISSIONS","WRITE_EXTERNAL_STORAGE","cameraContent","styles","preview","textBlocks","maskOutter","flex","maskRowHeight","maskRow","maskFrame","maskCenter","width","maskColWidth","maskInner","flexDirection","justifyContent","backgroundColor","capture","container","hintContain","hint","Dimensions","get","height","Math","round","StyleSheet","create","position","alignItems","borderRadius","padding","paddingHorizontal","alignSelf","marginBottom","paddingLeft","paddingRight","textAlign","left","top","display","borderColor","borderWidth"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from 'react'\nimport { i18n } from 'react-native-i18n-localize';\nimport { useNavigationState } from '@react-navigation/native';\nimport { TouchableOpacity, StyleSheet, Text, Dimensions, View, Alert, Platform,PermissionsAndroid } from 'react-native';\nimport { RNCamera } from 'react-native-camera';\nimport ImageResizer from 'react-native-image-resizer';\nimport RNFS from 'react-native-fs';\nimport Marker from 'react-native-image-marker'\nimport { dirPictures } from '../storage/dirStorage';\nconst moment = require('moment');\n\n\nlet alertFlag = true;\n\nconst Alpr = ({ navigation, route }) => {\n\n  const [detectedText, setDetectedText] = useState([]);\n  const [hintNumber, setHintNumber] = useState('');\n  const cameraRef = useRef(null);\n  const routesName = useNavigationState(state => state.routes[state.index].name);\n\n  const licList = [\n    'ZH', 'BE', 'LU', 'UR', 'SZ', 'OW', 'NW', 'GL', 'ZG', 'FR', 'SO', 'BS', 'BL', 'SH', 'AR', 'AI', 'SG', 'GR', 'AG', 'TG', 'TI', 'VD', 'VS', 'NE', 'GE', 'JU'\n  ];\n\n  let count = 0;\n\n  const failedToSaveImage = () => {\n    Alert.alert(\n      i18n.t('warn'),\n      i18n.t('failed_save_picture'),\n      [\n        {\n          text: i18n.t('ignore'),\n          onPress: () => {\n            navigation.navigate('CreateViolation', { scanned_licplate: hintNumber, alprImage: 'empty' });\n            alertFlag = true;\n          },\n          // style: 'ignore'\n        },\n        {\n          text: i18n.t('try_again'),\n          onPress: () => { alertFlag = true; }\n        }\n      ]\n    );\n  }\n\n  const setLicPlate = async () => {\n\n    alertFlag = false;\n\n    if (cameraRef) {\n\n\n      if (hintNumber == '') {\n        Alert.alert(\n          i18n.t('warn'),\n          i18n.t('no_licplate'),\n          [{ text: i18n.t('ok'), },]\n        );\n      }\n      else {\n\n        const options = { quality: 0.5, base64: true };\n        const data = await cameraRef.current.takePictureAsync(options);\n\n        const newImageName = `${moment().format('DDMMYY_HHmmSSS')}.jpg`;\n        const newFilepath = 'file://' + `${dirPictures}/${newImageName}`;\n\n        ImageResizer.createResizedImage('data:image/jpeg;base64,' + data.base64, 1000, 1300, 'JPEG', 60, 90)\n          .then(response => {\n\n            let markText = `${moment().format('DD.MM.YYYY HH:mm:ss')}` + ' ' + route.params.gpsText;\n            Marker.markText({\n              src: (Platform.OS === 'android' ? 'file://' + response.path : response.path),\n              text: markText,\n              X: 10,\n              Y: 10,\n              color: '#fff',\n              fontName: 'Arial-BoldItalicMT',\n              fontSize: 15,\n              scale: 1,\n              quality: 100,\n              textBackgroundStyle: {\n                type: 'default',\n                paddingX: 10,\n                paddingY: 10,\n                color: '#999'\n              }\n            }).then((res) => {\n              \n              RNFS.moveFile((Platform.OS === 'android' ? 'file://' + res : res), newFilepath);\n              RNFS.scanFile(newFilepath);\n\n              navigation.navigate('CreateViolation', { scanned_licplate: hintNumber, alprImage: newFilepath });\n              alertFlag = true;\n              console.log(newFilepath)\n            }).catch((err) => {\n              failedToSaveImage()\n              console.log('error 1 ===  ',err);\n            })\n          })\n          .catch(err => {\n            failedToSaveImage()\n            console.log('error 2 ===  ',err);\n          });\n\n      }\n\n    }\n\n  };\n\n\n  const recognizeNumber = (block) => {\n\n\n    count++;\n    if (count == 4 && alertFlag) {\n      setDetectedText(block);\n      showHint();\n      count = 0;\n    }\n\n\n  }\n\n  const showHint = () => {\n    if (detectedText != null) {\n\n\n      for (let i = 0; i < detectedText.length; i++) {\n\n        const regex = /[A-Z]{2}[ ]{0,1}[-]{0,1}[0-9]{1,7}/g;\n        const found = detectedText[i].value.match(regex);\n\n        if (found != null) {\n          let tempLic = found[0].split(\" \").join(\"\");\n          let Lic = tempLic.split(\"-\").join(\"\");\n\n          let exist = false;\n          licList.map(item => {\n            if (Lic.indexOf(item) >= 0)\n              exist = true;\n          });\n\n          if (exist)\n            setHintNumber(Lic);\n          break;\n        }\n\n      }\n    }\n  }\n\n\n  useEffect(\n    () => navigation.addListener('focus', () =>\n      {alertFlag = true;\n      PermissionsAndroid.request(PermissionsAndroid.PERMISSIONS.WRITE_EXTERNAL_STORAGE);}\n    ),\n    []\n  );\n\n  const cameraContent = (\n    <RNCamera\n      ref={cameraRef}\n      style={styles.preview}\n      captureAudio={false}\n      onTextRecognized={(text) => recognizeNumber(text.textBlocks)}\n    >\n      <View style={styles.maskOutter}>\n        <View style={[{ flex: maskRowHeight }, styles.maskRow, styles.maskFrame]} />\n        <View style={[{ flex: 30 }, styles.maskCenter]}>\n          <View style={[{ width: maskColWidth }, styles.maskFrame]} />\n          <View style={styles.maskInner} />\n          <View style={[{ width: maskColWidth }, styles.maskFrame]} />\n        </View>\n        <View style={[{ flex: maskRowHeight }, styles.maskRow, styles.maskFrame]} />\n      </View>\n      <View style={{ flex: 0, flexDirection: 'row', justifyContent: 'center', backgroundColor: 'transparent' }}>\n        <TouchableOpacity style={styles.capture} \n        onPress={setLicPlate}\n        >\n          <Text style={{ fontSize: 14 }}> {i18n.t('confirm')} </Text>\n        </TouchableOpacity>\n      </View>\n    </RNCamera>\n  );\n\n  return (\n    <View style={styles.container}>\n      {(routesName == \"Alpr\") && cameraContent}\n\n      <View style={styles.hintContain}>\n        <Text style={styles.hint}>\n          {i18n.t('scanned_data')}:  {hintNumber}\n        </Text>\n      </View>\n\n\n    </View>\n  );\n\n\n}\n\nexport default Alpr;\n\nconst { height, width } = Dimensions.get('window');\nconst maskRowHeight = Math.round((height - 300) / 20);\nconst maskColWidth = (width - 300) / 2;\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    flexDirection: 'column',\n    backgroundColor: 'black',\n    position: 'relative'\n  },\n  preview: {\n    flex: 1,\n    justifyContent: 'flex-end',\n    alignItems: 'center',\n  },\n  capture: {\n    flex: 0,\n    backgroundColor: '#fff',\n    borderRadius: 5,\n    padding: 15,\n    paddingHorizontal: 20,\n    alignSelf: 'center',\n    marginBottom: 30,\n  },\n  hint: {\n    fontSize: 20,\n    color: '#fff',\n    width: '100%',\n    padding: 5,\n    paddingLeft: 10,\n    paddingRight: 10,\n    textAlign: 'center',\n  },\n  hintContain: {\n    position: 'absolute',\n    left: 0,\n    top: 0,\n    width: '100%',\n    backgroundColor: \"#126FEA\",\n    textAlign: \"center\",\n    display: \"flex\",\n    height: 70,\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: \"center\"\n  },\n  maskOutter: {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    width: '100%',\n    height: '100%',\n    alignItems: 'center',\n    justifyContent: 'space-around',\n  },\n  maskInner: {\n    width: (width - 40),\n    backgroundColor: 'transparent',\n    borderColor: 'white',\n    borderWidth: 1,\n  },\n  maskFrame: {\n    backgroundColor: 'rgba(1,1,1,0.6)',\n  },\n  maskRow: {\n    width: '100%',\n  },\n  maskCenter: { flexDirection: 'row' },\n});"]},"metadata":{},"sourceType":"script"}